# 更新日志

## 最新更新

### 新增功能

1. **文件夹支持**
   - 现在可以直接拖拽文件夹进行处理
   - 文件夹会被自动打包、重命名、上传

2. **zst格式支持**
   - 新增zst压缩格式（双层压缩）
   - 结构：外层zst包含内层7z压缩包
   - 提供更高的压缩率

3. **图片压缩格式选择**
   - **WebP**: 平衡的压缩率和速度，兼容性好（默认）
   - **AVIF**: 更高压缩率，文件更小，但编码较慢
   - 可在高级配置中选择

4. **自动分类匹配**
   - 自动从API获取分类列表
   - 根据文件名智能匹配coser分类
   - 自动使用对应的categoryId

5. **灵活的处理选项**
   - **跳过登录**: 可以完全跳过登录，不执行任何API操作（只打包和压缩）
   - **是否上传**: 可以选择只打包不上传
   - **是否发布**: 可以选择只上传图片不创建文章
   - **保留压缩图片**: 可以选择保留压缩后的图片供其他用途
   - 压缩图片会保存到输出目录的 `文件名_compressed` 文件夹

5. **完整的配置GUI**
   - 新增"高级配置"按钮
   - 四个配置标签页：
     * 文件处理：前缀、密码列表
     * 图片压缩：尺寸、质量
     * API配置：接口地址、批次大小
     * 系统配置：重试次数、超时设置、上传选项

6. **FFmpeg路径优化**
   - 支持多个FFmpeg路径查找
   - 更友好的工具说明文档

### 配置说明

#### 压缩格式
- **7z**: 高压缩率，支持固实压缩
- **zip**: 通用格式，兼容性好
- **zst**: 双层压缩（内层7z+外层zstd），最高压缩率

#### 高级配置项

**文件处理**
- 图片文件前缀：重命名后的图片前缀（默认：cosfan.cc_）
- 视频文件前缀：重命名后的视频前缀（默认：video_）
- 压缩包密码：创建压缩包时使用的密码
- 解压密码列表：尝试解压时使用的密码列表

**图片压缩**
- 最大高度/宽度：压缩后图片的最大尺寸
- 图片质量：压缩质量（1-100）
- 压缩格式：WebP（快速，兼容）或 AVIF（高压缩率）
- 注意：压缩后的图片仅用于上传，原图保留在压缩包中

**API配置**
- 上传API：文件上传接口地址
- 文章API：文章提交接口地址
- 登录API：用户登录接口地址
- 分类API：分类列表接口地址
- 上传批次大小：每批上传的图片数量
- API超时：API请求超时时间（秒）

**系统配置**
- 最大重试次数：操作失败时的重试次数
- 解压超时：解压操作的超时时间（秒）
- 日志保留天数：日志文件保留天数
- 删除压缩图片：是否删除压缩后的图片（不勾选则保留）
- 启用上传功能：是否上传到API（不勾选则只打包）
- 发布文章：是否创建文章（不勾选则只上传图片）

### 处理模式

**完整模式（默认）**
- 启用上传功能：✓
- 发布文章：✓
- 删除压缩图片：✓
- 流程：解压/复制 → 重命名 → 打包 → 压缩图片 → 上传 → 创建文章 → 清理

**只上传不发布模式**
- 启用上传功能：✓
- 发布文章：✗
- 删除压缩图片：✓
- 流程：解压/复制 → 重命名 → 打包 → 压缩图片 → 上传 → 清理
- 结果：生成压缩包 + 图片已上传（可手动创建文章使用）

**仅打包模式**
- 启用上传功能：✗
- 发布文章：N/A
- 删除压缩图片：✗
- 流程：解压/复制 → 重命名 → 打包 → 压缩图片 → 保存压缩图片 → 清理
- 结果：生成压缩包 + 压缩图片文件夹

**保留压缩图片模式**
- 启用上传功能：✓
- 发布文章：✓
- 删除压缩图片：✗
- 流程：解压/复制 → 重命名 → 打包 → 压缩图片 → 上传 → 创建文章 → 保存压缩图片 → 清理
- 结果：生成压缩包 + 压缩图片文件夹 + 已发布文章

### 使用说明

1. **基本使用**
   - 拖拽压缩文件或文件夹到窗口
   - 配置输出目录和登录信息
   - 点击"开始处理"

2. **高级配置**
   - 点击"高级配置"按钮
   - 在标签页中修改相应配置
   - 点击"保存"应用更改

3. **工具要求**
   - 7-Zip：必需（用于解压和压缩）
   - FFmpeg：必需（用于视频处理）
   - 将工具放在tools目录或安装到系统PATH

### 技术细节

**zst双层压缩流程**
1. 创建内层7z压缩包（包含所有文件，支持密码）
2. 使用zstd压缩7z文件
3. 自动删除临时的7z文件
4. 最终得到.zst文件

**分类匹配逻辑**
1. 启动时从API获取分类列表并缓存
2. 处理文件时根据标题匹配分类名称
3. 优先匹配主分类（父分类）
4. 未匹配时使用默认分类ID 2

**文件夹处理流程**
1. 复制文件夹到临时目录
2. 清理不需要的文件（.html, .txt等）
3. 重命名图片和视频文件
4. 创建压缩包
5. 压缩图片用于上传
6. 上传并提交文章
